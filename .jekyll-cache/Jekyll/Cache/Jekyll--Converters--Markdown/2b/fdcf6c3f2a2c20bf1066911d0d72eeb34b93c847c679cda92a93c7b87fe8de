I"Œ„<ul id="markdown-toc">
  <li><a href="#åŸºç¡€" id="markdown-toc-åŸºç¡€">åŸºç¡€</a></li>
  <li><a href="#å®ä¾‹" id="markdown-toc-å®ä¾‹">å®ä¾‹</a>    <ul>
      <li><a href="#restful-webæœåŠ¡" id="markdown-toc-restful-webæœåŠ¡">RESTful WebæœåŠ¡</a></li>
      <li><a href="#æä¾›æ–‡ä»¶æœåŠ¡" id="markdown-toc-æä¾›æ–‡ä»¶æœåŠ¡">æä¾›æ–‡ä»¶æœåŠ¡</a></li>
      <li><a href="#ä»è¡¨å•ä¸­æ¥å—ç”¨æˆ·è¾“å…¥" id="markdown-toc-ä»è¡¨å•ä¸­æ¥å—ç”¨æˆ·è¾“å…¥">ä»è¡¨å•ä¸­æ¥å—ç”¨æˆ·è¾“å…¥</a></li>
    </ul>
  </li>
</ul>

<p><code class="highlighter-rouge">HTTP</code>æ˜¯<code class="highlighter-rouge">Node</code>çš„ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€äº›å¾ˆåº•å±‚çš„<code class="highlighter-rouge">API</code>ã€‚</p>

<p><code class="highlighter-rouge">Node</code>æœ‰ä¸ºæ•°ä¸å¤šçš„<em>å†…ç½®</em>æ¨¡å—ï¼Œ<code class="highlighter-rouge">HTTP</code>æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œ<code class="highlighter-rouge">fs</code>ä¹Ÿæ˜¯ã€‚è¿™äº›å†…ç½®æ¨¡å—ä½ é€šå¸¸å¯ä»¥åœ¨<code class="highlighter-rouge">Node</code>çš„<a href="https://nodejs.org/en/docs/">å®˜æ–¹ç½‘ç«™çš„<code class="highlighter-rouge">DOCS</code></a>è·å–å¹¶äº†è§£ä»–ä»¬çš„ä½¿ç”¨æ–¹æ³•å’Œ<code class="highlighter-rouge">API</code>ã€‚<code class="highlighter-rouge">HTTP</code>çš„ç›¸å…³<code class="highlighter-rouge">API</code>æ”¾åœ¨äº†è¿™é‡Œï¼š<a href="https://nodejs.org/dist/latest-v6.x/docs/api/http.html">https://nodejs.org/dist/latest-v6.x/docs/api/http.html</a></p>

<blockquote>
  <p>è¿™æ˜¯<code class="highlighter-rouge">v6.11.0</code>çš„ç‰ˆæœ¬ï¼Œå°±æ˜¯å†™åšå®¢çš„æœ€è¿‘ç‰ˆæœ¬ã€‚å¯ä»¥åœ¨å®˜ç½‘ä¸Šè·å–åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚å…¶ä¸­æ ‡è®°ä¸º<code class="highlighter-rouge">Stability:2 - Stable</code>çš„è¡¨ç¤ºä¸ºå¯æ”¾å¿ƒé£Ÿç”¨çš„<code class="highlighter-rouge">API</code>ï¼Œæ ‡è®°ä¸º<code class="highlighter-rouge">Stability:1 - Experimental</code>çš„è¡¨ç¤ºä¸ºè¯•éªŒæ€§è´¨çš„<code class="highlighter-rouge">API</code>ï¼Œæ ‡è®°ä¸º<code class="highlighter-rouge">Stability:0 - Deprecated</code>çš„è¡¨ç¤ºä¸ºè¢«å¼ƒç”¨çš„<code class="highlighter-rouge">API</code>ã€‚</p>
</blockquote>

<p>åœ¨æ–‡æ¡£ä¸­å¾ˆç®€è¦åœ°ä»‹ç»äº†ä¸€å¥ï¼š</p>

<blockquote>
To use the HTTP server and client one must require('http').
</blockquote>

<!-- more -->

<h2 id="åŸºç¡€">åŸºç¡€</h2>

<ol>
  <li>å¼•å…¥<code class="highlighter-rouge">http</code>æ¨¡å—ã€‚</li>
</ol>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<ol>
  <li>åˆ›å»º<code class="highlighter-rouge">HTTP</code>æœåŠ¡å™¨</li>
</ol>

<p>åˆ›å»º<code class="highlighter-rouge">HTTP</code>æœåŠ¡å™¨è¦è°ƒç”¨<code class="highlighter-rouge">http.createServer()</code>å‡½æ•°ã€‚å®ƒåªæœ‰ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ŒæœåŠ¡å™¨æ¯æ¬¡æ”¶åˆ°<code class="highlighter-rouge">HTTP</code>è¯·æ±‚åéƒ½ä¼šè°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°ã€‚</p>

<p>è¿™ä¸ªè¯·æ±‚å›è°ƒä¼šæ”¶åˆ°ä¸¤ä¸ªå‚æ•°ï¼Œè¯·æ±‚å¯¹è±¡ â€“ <code class="highlighter-rouge">req</code>ï¼Œå“åº”å¯¹è±¡ â€“ <code class="highlighter-rouge">res</code>ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">){</span>
    <span class="c1">// å¤„ç†è¯·æ±‚</span>
<span class="p">});</span>
</code></pre></div></div>

<p>æœåŠ¡å™¨æ¯æ”¶åˆ°ä¸€æ¡<code class="highlighter-rouge">HTTP</code>è¯·æ±‚ï¼Œéƒ½ä¼šç”¨æ–°çš„<code class="highlighter-rouge">req</code>å’Œ<code class="highlighter-rouge">res</code>å¯¹è±¡è§¦å‘å›è°ƒå‡½æ•°ã€‚æ³¨æ„ï¼Œåœ¨è§¦å‘å›è°ƒå‡½æ•°ä¹‹å‰ï¼Œ<code class="highlighter-rouge">Node</code>ä¼šè§£æè¯·æ±‚çš„<code class="highlighter-rouge">HTTP</code>å¤´ï¼Œå¹¶å°†ä»–ä»¬ä½œä¸º<code class="highlighter-rouge">req</code>å¯¹è±¡çš„ä¸€éƒ¨åˆ†æä¾›ç»™å›è°ƒå‡½æ•°ã€‚ä½†<code class="highlighter-rouge">Node</code>ä¸ä¼šåœ¨å›è°ƒå‡½æ•°è¢«è§¦å‘ä¹‹å‰å¯¹è¯·æ±‚ä½“çš„è§£æï¼Œ<code class="highlighter-rouge">HTTP</code>æœåŠ¡å™¨è§£æå®Œ<code class="highlighter-rouge">HTTP</code>å¤´ï¼Œå°±å°†æ§åˆ¶æƒè½¬äº¤ç»™å›è°ƒå‡½æ•°ã€‚</p>

<ol>
  <li>å¤„ç†è¯·æ±‚</li>
</ol>

<p>ä½ å¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚å¤„ç†è¯·æ±‚ï¼Œæˆ‘ä»¬è¿™é‡Œé¦–å…ˆè°ƒç”¨<code class="highlighter-rouge">res.write()</code>æ–¹æ³•ï¼Œå°†ä¼šå“åº”ä¸€ä¸ªæ•°æ®å—ï¼Œç„¶åç”¨<code class="highlighter-rouge">res.end()</code>æ–¹æ³•æ¥ç»“æŸè¿™ä¸ªå“åº”ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">){</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">write</span> <span class="p">(</span><span class="dl">'</span><span class="s1">Hello World</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span> <span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<blockquote>
  <p><code class="highlighter-rouge">res.write ()</code>å’Œ<code class="highlighter-rouge">res.end ()</code>ä¹Ÿèƒ½ç®€å†™æˆ<code class="highlighter-rouge">res.end('Hello World')</code>ã€‚</p>
</blockquote>

<p>åœ¨<code class="highlighter-rouge">res.write ()</code>å’Œ<code class="highlighter-rouge">res.end ()</code>ä¹‹å‰ï¼Œè¿˜å¯ä»¥å¯¹<code class="highlighter-rouge">HTTP</code>çš„å“åº”å¤´éƒ¨å­—æ®µè¿›è¡Œä¿®æ”¹ã€‚æ–¹æ³•æœ‰<code class="highlighter-rouge">res.setHeader(field,value)</code>ã€<code class="highlighter-rouge">res.getHeader(field)</code>ã€<code class="highlighter-rouge">res.removeHeader(field)</code>ã€‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†é»˜è®¤çš„çŠ¶æ€ç <code class="highlighter-rouge">200</code>å’Œé»˜è®¤çš„å“åº”å¤´ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Hello World</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span> <span class="p">(</span><span class="dl">'</span><span class="s1">Content-Length</span><span class="dl">'</span><span class="p">,</span> <span class="nx">body</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
<span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span> <span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
<span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
</code></pre></div></div>

<ol>
  <li>ç»‘å®šä¸€ä¸ªç«¯å£</li>
</ol>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">){</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">write</span> <span class="p">(</span><span class="dl">'</span><span class="s1">Hello World</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span> <span class="p">();</span>
<span class="p">});</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
</code></pre></div></div>

<hr />

<h2 id="å®ä¾‹">å®ä¾‹</h2>

<h3 id="restful-webæœåŠ¡">RESTful WebæœåŠ¡</h3>

<p><code class="highlighter-rouge">REST</code>(Representational State Transfer)æ˜¯ä¸€ç§ä½¿ç”¨<code class="highlighter-rouge">HTTP</code>è°“è¯æä¾›ç²¾ç®€çš„<code class="highlighter-rouge">API</code>æœåŠ¡ã€‚æŒ‰ç…§æƒ¯ä¾‹ï¼Œ<code class="highlighter-rouge">HTTP</code>è°“è¯<code class="highlighter-rouge">GET</code>ã€<code class="highlighter-rouge">POST</code>ã€<code class="highlighter-rouge">PUT</code>ã€<code class="highlighter-rouge">DELETE</code>ï¼Œåˆ†åˆ«æ ¹ç”±<code class="highlighter-rouge">URL</code>æŒ‡å®šçš„èµ„æºçš„è·å–ã€åˆ›å»ºã€æ›´æ–°å’Œç§»é™¤ç›¸å¯¹åº”ã€‚</p>

<blockquote>
  <p>å…·ä½“çš„<code class="highlighter-rouge">RESTful</code>æœåŠ¡ï¼Œæˆ‘å»ºè®®å‚è€ƒStackOverflowå…³äºè¿™ä¸ªçš„é—®ç­”: <a href="https://stackoverflow.com/questions/671118/what-exactly-is-restful-programming">https://stackoverflow.com/questions/671118/what-exactly-is-restful-programming</a></p>
</blockquote>

<p>å…¶æ¬¡ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨åˆ°äº†<code class="highlighter-rouge">cURL</code>è¿™ä¸ªå·¥å…·ï¼Œä»£æ›¿Webæµè§ˆå™¨æ¥äºWebæœåŠ¡å™¨äº¤äº’ã€‚</p>

<blockquote>
  <p><code class="highlighter-rouge">cURL</code>çš„å®˜ç½‘åœ¨è¿™é‡Œ: <a href="https://curl.haxx.se/">https://curl.haxx.se/</a>ã€‚<code class="highlighter-rouge">github</code>çš„åœ°å€: <a href="https://github.com/curl/curl">https://github.com/curl/curl</a>ã€‚å®˜ç½‘æœ‰å…³äº<code class="highlighter-rouge">cURL</code>çš„å…¨éƒ¨æ•™ç¨‹ã€‚</p>
</blockquote>

<p><code class="highlighter-rouge">cRUL</code>æ˜¯ä¸ªå¾ˆæ£’çš„å·¥å…·ï¼Œè‡ªå·±ä¹Ÿåªæ˜¯äº†è§£ä¸€ç‚¹ç‚¹ã€‚æ¯”å¦‚æˆ‘ä»¬è¾“å…¥ï¼š <code class="highlighter-rouge">curl -I http://xiaokedada.com</code>ï¼Œ åˆ™æˆ‘ä»¬å¾—åˆ°ï¼š</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Thu, 08 Jun 2017 02:08:09 GMT</span>
<span class="na">Server</span><span class="p">:</span> <span class="s">Apache/2.4.23</span>
<span class="na">Last-Modified</span><span class="p">:</span> <span class="s">Wed, 07 Jun 2017 14:01:00 GMT</span>
<span class="na">ETag</span><span class="p">:</span> <span class="s">"13c00c3-8e4d-5515f2a869975"</span>
<span class="na">Accept-Ranges</span><span class="p">:</span> <span class="s">bytes</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">36429</span>
<span class="na">Vary</span><span class="p">:</span> <span class="s">Accept-Encoding,User-Agent</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html</span>
</code></pre></div></div>

<p>æ›´å¤šæœ‰å…³<code class="highlighter-rouge">cURL</code>å·¥å…·å¾…åç»­äº†è§£ï¼Œé‚£ä¸ªæ—¶å€™ï¼Œä¹Ÿä¼šå¦å¼€ä¸€ç¯‡æ–‡ç« å§ã€‚è¿˜è¦ä»‹ç»çš„ä¸€ç‚¹å°±æ˜¯æœ‰å…³<code class="highlighter-rouge">cURL</code>çš„å®‰è£…ã€‚æˆ‘ä»¬åœ¨ä¸‹è½½é¡µæ ¹æ®ç³»ç»Ÿæ‰¾åˆ°å¯¹åº”çš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚æˆ‘ä¸‹è½½çš„å°±æ˜¯<code class="highlighter-rouge">Win64 x86_64 CAB</code>ç‰ˆæœ¬ï¼Œç„¶ååœ¨è§£å‹åˆ°æœ¬åœ°æ–‡ä»¶å¤¹ï¼Œåœ¨<code class="highlighter-rouge">1386</code>æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°<code class="highlighter-rouge">CURL.exe</code>ï¼Œå°†å®ƒæ‹·è´åˆ°<code class="highlighter-rouge">Windows/System32</code>æ–‡ä»¶ä¸­ã€‚</p>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬<code class="highlighter-rouge">RESTful</code>çš„ä¾‹å­å¦‚ä¸‹ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">),</span>
  <span class="nx">url</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">url</span><span class="dl">'</span><span class="p">),</span>
  <span class="nx">items</span> <span class="o">=</span> <span class="p">[]</span>

<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">:</span>    <span class="c1">//è¯·æ±‚èµ„æº</span>
      <span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="dl">''</span>
      <span class="nx">req</span><span class="p">.</span><span class="nx">setEncoding</span><span class="p">(</span><span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">)</span>   <span class="c1">//å¯¹äºæ–‡æœ¬æ ¼å¼çš„å¾…åŠäº‹é¡¹è€Œè¨€ï¼Œæˆ‘ä»¬ä¸éœ€è¦äºŒè¿›åˆ¶ï¼Œå°†å®ƒè®¾å®šä¸ºutf8</span>
      <span class="nx">req</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">data</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">chunk</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//åªè¦è¯»å…¥æ–°çš„utf8å­—ç¬¦ä¸²ï¼Œå°±èƒ½è§¦å‘dataäº‹ä»¶</span>
        <span class="nx">item</span> <span class="o">+=</span> <span class="nx">chunk</span>
      <span class="p">})</span>
      <span class="nx">req</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">end</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">items</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="dl">'</span><span class="s1">OK</span><span class="se">\n</span><span class="dl">'</span><span class="p">)</span>
      <span class="p">})</span>
      <span class="k">break</span>
    <span class="k">case</span> <span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">:</span>     <span class="c1">//è·å–èµ„æº</span>
      <span class="nx">items</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">)</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">item</span> <span class="o">+</span> <span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">)</span>
      <span class="p">})</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
      <span class="k">break</span>
    <span class="k">case</span> <span class="dl">'</span><span class="s1">DELETE</span><span class="dl">'</span><span class="p">:</span>
      <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">).</span><span class="nx">pathname</span>
      <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>

      <span class="k">if</span> <span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">404</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid item id</span><span class="dl">'</span><span class="p">)</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="dl">'</span><span class="s1">Item not found</span><span class="dl">'</span><span class="p">)</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">items</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="dl">'</span><span class="s1">OK</span><span class="se">\n</span><span class="dl">'</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="k">break</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
</code></pre></div></div>

<p>ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œ<code class="highlighter-rouge">url</code>æ¨¡å—å¯ä»¥çš„<code class="highlighter-rouge">parse()</code>å¯ä»¥è§£æå‡º<code class="highlighter-rouge">pathname</code>ã€‚è®©æˆ‘ä»¬åœ¨<code class="highlighter-rouge">Node</code>çš„<code class="highlighter-rouge">REPL</code>( Readâ€“Evalâ€“Print Loop)ç¯å¢ƒï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„å‘½ä»¤è¡Œç¯å¢ƒéªŒè¯ä»¥ä¸‹ï¼Œè¿˜æ˜¯ä»¥æœ¬åšå®¢é¦–é¡µä¸ºä¾‹ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> require<span class="o">(</span><span class="s1">'url'</span><span class="o">)</span>.parse<span class="o">(</span><span class="s1">'http://xiaokdedada.com'</span><span class="o">)</span><span class="p">;</span>
Url <span class="o">{</span>
  protocol: <span class="s1">'http:'</span>,
  slashes: <span class="nb">true</span>,
  auth: null,
  host: <span class="s1">'xiaokdedada.com'</span>,
  port: null,
  <span class="nb">hostname</span>: <span class="s1">'xiaokdedada.com'</span>,
  <span class="nb">hash</span>: null,
  search: null,
  query: null,
  pathname: <span class="s1">'/'</span>,
  path: <span class="s1">'/'</span>,
  href: <span class="s1">'http://xiaokdedada.com/'</span> <span class="o">}</span>
</code></pre></div></div>

<p>ä¸ºäº†ç®€å•ï¼Œæˆ‘ä»¬çš„<code class="highlighter-rouge">RESTful</code>çœç•¥äº†<code class="highlighter-rouge">PUT</code>è°“è¯ã€‚æˆ‘ä»¬æ¥éªŒè¯æˆ‘ä»¬çš„<code class="highlighter-rouge">RESTful</code>æœåŠ¡å™¨ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¿è¡Œæˆ‘ä»¬çš„<code class="highlighter-rouge">.js</code>æ–‡ä»¶ï¼Œå¼€å¯<code class="highlighter-rouge">3000</code>ç«¯å£ã€‚ç„¶åï¼Œå†å¼€ä¸€ä¸ªå‘½ä»¤è¡Œ:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-d</span> <span class="s2">"Hello World"</span> http://localhost:3000
OK
<span class="nv">$ </span>curl <span class="nt">-d</span> <span class="s2">"I am timi"</span> http://localhost:3000
OK
<span class="nv">$ </span>curl http://localhost:3000
0<span class="o">)</span> Hello World
1<span class="o">)</span> I am timi
</code></pre></div></div>

<p>å¾ˆæ£’æ˜¯ä¸æ˜¯ï¼Ÿ</p>

<h3 id="æä¾›æ–‡ä»¶æœåŠ¡">æä¾›æ–‡ä»¶æœåŠ¡</h3>

<p>æ–‡ä»¶æœåŠ¡é€šå¸¸æ¶‰åŠåˆ°çš„æ˜¯æ–‡ä»¶çš„è¯»å†™ï¼Œåœ¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨çš„æ˜¯ç®¡é“(<code class="highlighter-rouge">pipe</code>)ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">stream</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
<span class="nx">stream</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span> <span class="c1">//resæ˜¯å“åº”ï¼Œres.end()ä¼šåœ¨stream.pipe()å†…éƒ¨è°ƒç”¨</span>
</code></pre></div></div>

<blockquote>
  <p>åœ¨<code class="highlighter-rouge">Node</code>ä¸­ï¼Œæ‰€æœ‰ç»§æ‰¿äº†<code class="highlighter-rouge">EventEmitter</code>çš„ç±»éƒ½æœ‰å¯èƒ½æœ‰<code class="highlighter-rouge">error</code>äº‹ä»¶ã€‚å¯¹äº<code class="highlighter-rouge">fs.ReadStream</code>è¿™æ ·çš„ä¸“ç”¨<code class="highlighter-rouge">EventEmitter</code>ï¼Œæœ‰é¢„å…ˆå®šä¹‰çš„<code class="highlighter-rouge">data</code>å’Œ<code class="highlighter-rouge">end</code>äº‹ä»¶ã€‚</p>
</blockquote>

<h3 id="ä»è¡¨å•ä¸­æ¥å—ç”¨æˆ·è¾“å…¥">ä»è¡¨å•ä¸­æ¥å—ç”¨æˆ·è¾“å…¥</h3>

<p>æˆ‘ä»¬çœ‹è¿™ä¸ªä¾‹å­ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">),</span>
    <span class="nx">qs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">querystring</span><span class="dl">'</span><span class="p">),</span>
    <span class="nx">items</span> <span class="o">=</span> <span class="p">[];</span>

<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span> <span class="o">==</span> <span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">){</span>        <span class="c1">//æ‰€æœ‰ä¸æ˜¯"/"çš„URLéƒ½ä¼šå¾—åˆ°ä¸€ä¸ª404 Not Found</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span><span class="p">){</span>
            <span class="k">case</span> <span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">:</span>
                <span class="nx">show</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">:</span>
                <span class="nx">add</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="nl">default</span><span class="p">:</span>
                <span class="nx">badRequest</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">notFound</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">show</span> <span class="p">(</span><span class="nx">res</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">&lt;html&gt;&lt;head&gt;&lt;title&gt;Todo List&lt;/title&gt;&lt;/head&gt;&lt;body&gt;</span><span class="dl">'</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">&lt;h1&gt;Todo List&lt;/h1&gt;</span><span class="dl">'</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">&lt;ul&gt;</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">items</span><span class="p">.</span><span class="nx">map</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">){</span>
        <span class="k">return</span> <span class="dl">'</span><span class="s1">&lt;li&gt;</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">item</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">&lt;/li&gt;</span><span class="dl">'</span>
    <span class="p">}).</span><span class="nx">join</span><span class="p">(</span><span class="dl">''</span><span class="p">)</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">&lt;/ul&gt;</span><span class="dl">'</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">&lt;form method="post" action="/"&gt;</span><span class="dl">'</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">&lt;p&gt;&lt;input type="text" name="item" /&gt;&lt;/p&gt;</span><span class="dl">'</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">&lt;p&gt;&lt;input type="submit" value="Add Item" /&gt;&lt;/p&gt;</span><span class="dl">'</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;</span><span class="dl">'</span><span class="p">;</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Length</span><span class="dl">'</span><span class="p">,</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">byteLength</span><span class="p">(</span><span class="nx">html</span><span class="p">));</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span> <span class="p">(</span><span class="nx">html</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">notFound</span> <span class="p">(</span><span class="nx">res</span><span class="p">){</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">404</span><span class="p">;</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span> <span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span> <span class="p">(</span><span class="dl">'</span><span class="s1">Not Found</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">badRequest</span> <span class="p">(</span><span class="nx">res</span><span class="p">){</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">400</span><span class="p">;</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span> <span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span> <span class="p">(</span><span class="dl">'</span><span class="s1">Bad Request</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">add</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">setEncoding</span> <span class="p">(</span><span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">on</span> <span class="p">(</span><span class="dl">'</span><span class="s1">data</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">chunk</span><span class="p">){</span><span class="nx">body</span> <span class="o">+=</span> <span class="nx">chunk</span><span class="p">});</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">on</span> <span class="p">(</span><span class="dl">'</span><span class="s1">end</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
        <span class="nx">items</span><span class="p">.</span><span class="nx">push</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">item</span><span class="p">);</span>
        <span class="nx">show</span> <span class="p">(</span><span class="nx">res</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p>åœ¨<code class="highlighter-rouge">add()</code>å‡½æ•°è§£æè¯·æ±‚å®ä½“æ—¶ï¼Œæˆ‘ä»¬ç”¨åˆ°äº†<code class="highlighter-rouge">Node</code>çš„<code class="highlighter-rouge">querystring</code>æ¨¡å—ã€‚å®˜æ–¹æ–‡æ¡£ä¸­æ˜¯è¿™æ ·ä»‹ç»çš„:</p>

<blockquote>
  <p>The querystring module provides utilities for parsing and formatting URL query strings.</p>
</blockquote>

<p>çœ‹ä¸€ä¸‹æˆ‘ä»¬åœ¨<code class="highlighter-rouge">REPL</code>ä¸Šçš„è§£æã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> var qs <span class="o">=</span> require<span class="o">(</span><span class="s1">'querystring'</span><span class="o">)</span><span class="p">;</span>var body <span class="o">=</span> <span class="s1">'item=timi+I+love+you'</span><span class="p">;</span>qs.parse<span class="o">(</span>body<span class="o">)</span><span class="p">;</span>
<span class="o">{</span> item: <span class="s1">'timi I love you'</span> <span class="o">}</span>
</code></pre></div></div>
:ET